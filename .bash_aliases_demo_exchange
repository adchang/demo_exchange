export API_GATEWAY_VERSION='0.0.2-dc'
export ACCOUNT_SERVICE_VERSION='0.0.2-dc'
export ORDER_SERVICE_VERSION='0.0.2-dc'

demo-exchange-apiGateway-up() {
  demo-exchange-apiGateway-build;
  demo-exchange-apiGateway-run;
}
demo-exchange-apiGateway-build() {
  docker rm -f demo_exchange.api_gateway-$API_GATEWAY_VERSION;
  docker image rm demo_exchange.api_gateway:$API_GATEWAY_VERSION;
  docker build -f src/DemoExchange.ApiGateway/Dockerfile --tag demo_exchange.api_gateway:$API_GATEWAY_VERSION .
  docker rmi -f $(docker images -f 'dangling=true' -q)
}
demo-exchange-apiGateway-run() {
  docker run --detach -p 8090:443 -e ASPNETCORE_URLS="https://+;http://+" -e ASPNETCORE_HTTPS_PORT=8090 -e ASPNETCORE_Kestrel__Certificates__Default__Password="PASSWORD" -e ASPNETCORE_Kestrel__Certificates__Default__Path=/https/DemoExchange.pfx -v /opt/adchang/htdocs/demo_exchange/docker:/https/ -v /opt/adchang/_log/demo_exchange:/log --name demo_exchange.api_gateway-$API_GATEWAY_VERSION demo_exchange.api_gateway:$API_GATEWAY_VERSION
}
demo-exchange-apiGateway-start() {
  docker-start demo_exchange.api_gateway-$API_GATEWAY_VERSION
}
demo-exchange-apiGateway-stop() {
  docker-stop demo_exchange.api_gateway-$API_GATEWAY_VERSION
}

demo-exchange-account-up() {
  demo-exchange-account-build;
  demo-exchange-account-run;
}
demo-exchange-account-build() {
  docker rm -f demo_exchange.account_service-$ACCOUNT_SERVICE_VERSION;
  docker image rm demo_exchange.account_service:$ACCOUNT_SERVICE_VERSION;
  docker build -f src/DemoExchange.AccountService/Dockerfile --tag demo_exchange.account_service:$ACCOUNT_SERVICE_VERSION .
  docker rmi -f $(docker images -f 'dangling=true' -q)
}
demo-exchange-account-run() {
  docker run --detach -p 8091:443 -e ASPNETCORE_URLS="https://+;http://+" -e ASPNETCORE_HTTPS_PORT=8091 -e ASPNETCORE_Kestrel__Certificates__Default__Password="PASSWORD" -e ASPNETCORE_Kestrel__Certificates__Default__Path=/https/DemoExchange.pfx -v /opt/adchang/htdocs/demo_exchange/docker:/https/ -v /opt/adchang/_log/demo_exchange:/log --name demo_exchange.account_service-$ACCOUNT_SERVICE_VERSION demo_exchange.account_service:$ACCOUNT_SERVICE_VERSION
}
demo-exchange-account-start() {
  docker-start demo_exchange.account_service-$ACCOUNT_SERVICE_VERSION
}
demo-exchange-account-stop() {
  docker-stop demo_exchange.account_service-$ACCOUNT_SERVICE_VERSION
}

demo-exchange-order-up() {
  demo-exchange-order-build;
  demo-exchange-order-run;
}
demo-exchange-order-build() {
  docker rm -f demo_exchange.order_service-$ORDER_SERVICE_VERSION;
  docker image rm demo_exchange.order_service:$ORDER_SERVICE_VERSION;
  docker build -f src/DemoExchange.OrderService/Dockerfile --tag demo_exchange.order_service:$ORDER_SERVICE_VERSION .
  docker rmi -f $(docker images -f 'dangling=true' -q)
}
demo-exchange-order-run() {
  docker run -v /opt/adchang/_log/demo_exchange:/log --publish 8080:80 --detach --name demo_exchange.order_service-$ORDER_SERVICE_VERSION demo_exchange.order_service:$ORDER_SERVICE_VERSION
}
demo-exchange-order-start() {
  docker-start demo_exchange.order_service-$ORDER_SERVICE_VERSION
}
demo-exchange-order-stop() {
  docker-stop demo_exchange.order_service-$ORDER_SERVICE_VERSION
}

demo-exchange-orderGrpc-up() {
  demo-exchange-orderGrpc-build;
  demo-exchange-orderGrpc-run;
}
demo-exchange-orderGrpc-build() {
  docker rm -f demo_exchange.order_service_grpc-$ORDER_SERVICE_VERSION;
  docker image rm demo_exchange.order_service_grpc:$ORDER_SERVICE_VERSION;
  docker build -f src/DemoExchange.OrderServiceGrpc/Dockerfile --tag demo_exchange.order_service_grpc:$ORDER_SERVICE_VERSION .
  docker rmi -f $(docker images -f 'dangling=true' -q)
}
demo-exchange-orderGrpc-run() {
  docker run --detach -p 8092:443 -e ASPNETCORE_URLS="https://+;http://+" -e ASPNETCORE_HTTPS_PORT=8092 -e ASPNETCORE_Kestrel__Certificates__Default__Password="PASSWORD" -e ASPNETCORE_Kestrel__Certificates__Default__Path=/https/DemoExchange.pfx -v /opt/adchang/htdocs/demo_exchange/docker:/https/ -v /opt/adchang/_log/demo_exchange:/log --name demo_exchange.order_service_grpc-$ORDER_SERVICE_VERSION demo_exchange.order_service_grpc:$ORDER_SERVICE_VERSION
}
demo-exchange-orderGrpc-start() {
  docker-start demo_exchange.order_service_grpc-$ORDER_SERVICE_VERSION
}
demo-exchange-orderGrpc-stop() {
  docker-stop demo_exchange.order_service_grpc-$ORDER_SERVICE_VERSION
}
